---
title: "WSL 折腾回顾"
date: 2021-06-09T14:44:38+08:00
draft: false
tags: ["WSL", "VM"]
---

最近开发环境频繁出现问题，具体表现是莫名其妙的端口占用，无论是用 `netstat` 命令还是 `TCPView` 工具都查不到。

发现这个问题是源于 IntelliJ IDEA 启动时报错，MySQL 启动不了。一番搜索，源头竟是 WSL 2。

在 WSL 2 中启动的服务可以在 Windows 10 主系统上通过 `localhost` 访问，这是通过端口转发实现的，问题就出在这个端口转发 `winnat` 上。

它会预先保留一系列端口，别的服务不能用，并且通过常规方式看不到占用，就很坑。

想要查看这个端口列表，需要通过管理员权限的终端运行 `netsh int ipv4 delete excludedportrange protocol=tcp` 命令查看。

当时运行完命令一看，好家伙，几乎一大半端口在这个列表里。

回想当时 WSL 2 刚出时，localhost转发就时好时坏，极不稳定，现在是稳定了，但是又有新的坑，不愧是你，BUG 10。

一努之下回滚到 WSL 1，通过 `net stop winnat` 命令关闭端口转发功能，并将开发环境迁回到主系统。

这几年从 WSL 1 折腾到 WSL 2，因为各种 BUG，在 WSL 与传统虚拟机之间反复横跳数次，终于觉得烦不胜烦。

虽说程序员应当保持好奇心，尝试新事物，但有时候成本真的很高，尤其是这种涉及到工作效率的东西。

说起这个，科技媒体发的文章以后看看就好，随便一个新东西他们都能吹出花来，他们只是浅尝辄止或者跟本没上过手，这些东西对他们来说只是一条新闻素材，只有真的深入使用才能体验到各种坑。
