<!DOCTYPE html>
<html>
<head>
    
        
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer-when-downgrade">

<title>自用 RSS 服务搭建 (Miniflux &#43; RSSHub)  - 张良计</title>
<meta name="description" content="">

<link rel="alternate" type="application/rss+xml" title="RSS" href="/rss/">

<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="/favicon.png">

<link rel="stylesheet" href="/css/style.css?rnd=1584685639" />

<meta property="og:title" content="自用 RSS 服务搭建 (Miniflux &#43; RSSHub)" />
<meta property="og:description" content="互联网越来越分裂，巨头们各自圈地，糟糕的用户体验，漫天飞舞的广告，让人不堪忍受。 好在总有各路大神们来解决痛点，RSSHub 就是其中之一。 RSSHub 是" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/rss-service-deployment-via-docker-on-ubuntu/" />
<meta property="article:published_time" content="2020-03-19T00:00:31+08:00" />
<meta property="article:modified_time" content="2020-03-19T00:00:31+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="自用 RSS 服务搭建 (Miniflux &#43; RSSHub)"/>
<meta name="twitter:description" content="互联网越来越分裂，巨头们各自圈地，糟糕的用户体验，漫天飞舞的广告，让人不堪忍受。 好在总有各路大神们来解决痛点，RSSHub 就是其中之一。 RSSHub 是"/>






    
</head>
<body>
    <div class="container">
        <header> 
            
                <h1 class="site-header">
    <a href="/">张良计</a>
</h1>
<nav>
    
    
</nav>

            
        </header>
        <main>
            

    <article class="post">
        <header>
            <h1>自用 RSS 服务搭建 (Miniflux &#43; RSSHub)</h1>
        </header>
        <div class="content">
            <p>互联网越来越分裂，巨头们各自圈地，糟糕的用户体验，漫天飞舞的广告，让人不堪忍受。</p>
<p>好在总有各路大神们来解决痛点，RSSHub 就是其中之一。</p>
<p>RSSHub 是一个开源易用的 RSS 生成器，可以给任何奇奇怪怪的内容生成 RSS 订阅源，官网有详细介绍，链接在文章底部。</p>
<p>Miniflux 是一个网页版 RSS 阅读器，简洁干净。</p>
<p>本文主要记录 Miniflux + RSSHub 的搭建过程。</p>
<hr>
<p>VPS 初始化以及 Docker 安装参考这篇文章 <a href="/posts/ubuntu-server-initiation-and-docker-installation">Ubuntu VPS 初始化设置 + Docker安装</a></p>
<h2 id="部署-miniflux">部署 Miniflux</h2>
<p>新建 Docker Compose 配置文件，保存为 <code>docker-compose-miniflux.yml</code> :</p>
<pre><code>version: '3'
services:
  miniflux:
    image: miniflux/miniflux:latest
    ports:
      - &quot;8080:8080&quot;
    depends_on:
      - db
    environment:
      - DATABASE_URL=postgres://miniflux:secret@db/miniflux?sslmode=disable
  db:
    image: postgres:latest
    environment:
      - POSTGRES_USER=miniflux
      - POSTGRES_PASSWORD=secret
    volumes:
      - miniflux-db:/var/lib/postgresql/data
volumes:
  miniflux-db:
</code></pre>
<p>启动服务:</p>
<pre><code>$ sudo docker-compose -f docker-compose-miniflux.yml up -d db
$ sudo docker-compose -f docker-compose-miniflux.yml up -d miniflux
</code></pre>
<p>初始化数据库:</p>
<pre><code>$ docker-compose -f docker-compose-miniflux.yml exec miniflux /usr/bin/miniflux -migrate
</code></pre>
<p>创建用户，根据提示输入用户名及密码:</p>
<pre><code>$ docker-compose -f docker-compose-miniflux.yml exec miniflux /usr/bin/miniflux -create-admin
</code></pre>
<p>部署完成，现在可以访问 <code>http://your-vps-ip:8080</code> 使用了。</p>
<h2 id="部署-rsshub">部署 RSSHub</h2>
<p>下载官方 Docker Compose 配置，保存为 <code>docker-compose-rsshub.yml</code> :</p>
<pre><code>$ wget https://raw.githubusercontent.com/DIYgod/RSSHub/master/docker-compose.yml -o docker-compose-rsshub.yml
</code></pre>
<p>创建 volume 持久化 Redis 缓存:</p>
<pre><code>$ docker volume create redis-data
</code></pre>
<p>启动:</p>
<pre><code>$ sudo docker-compose -f docker-compse-rsshub.yml up -d
</code></pre>
<p>部署完成，现在可以访问 <code>http://your-vps-ip:1200</code> 使用了。</p>
<h2 id="配置-nginx-端口转发使用域名访问">配置 Nginx 端口转发，使用域名访问</h2>
<p>解析域名到你的 VPS ，假设域名分别为:</p>
<pre><code>rss.example.com  # Miniflux
rsshub.example.com  # RSSHub
</code></pre>
<p>安装 Nginx :</p>
<pre><code>$ sudo apt install -y nginx
</code></pre>
<p>先简单修改下默认配置:</p>
<p>禁用 <code>IP</code> 直接访问，编辑 <code>/etc/nginx/site-available/default</code> ，注释掉 <code>location {}</code> ，接着写入:</p>
<pre><code>return 404;
</code></pre>
<p>隐藏 <code>404</code> 页面版本号，编辑 <code>/etc/nginx/nginx.conf</code> ，在 <code>http {}</code> 中写入:</p>
<pre><code>server_tokens off;
</code></pre>
<p>配置端口转发及域名访问，新建配置文件 <code>/etc/nginx/site-available/rss.conf</code> :</p>
<pre><code># Miniflux
server {
    listen 80;
    server_name rss.example.com;
    index index.html;
    location / {
        proxy_pass http://127.0.0.1:8080;
    }
}

# RSSHub
server {
    listen 80;
    server_name rsshub.example.com;
    index index.html;
    location / {
        proxy_pass http://127.0.0.1:1200;
    }
}
</code></pre>
<p>启用配置:</p>
<pre><code>$ sudo ln -s /etc/nginx/site-available/rss.conf /etc/ngxin/site-enabled/
</code></pre>
<p>重启服务:</p>
<pre><code>$ sudo nginx -s reload
</code></pre>
<p>现在可以用域名访问了。</p>
<h2 id="使用-acmesh-签发-lets-encrypt-证书">使用 acme.sh 签发 Let&rsquo;s Encrypt 证书</h2>
<p>以 root 身份安装 acme.sh:</p>
<pre><code>$ sudo su -
# apt install -y socat
# curl https://get.acme.sh | sh
# source ~/.bashrc
</code></pre>
<p>签发证书:</p>
<pre><code># acme.sh --issue --nginx -d rss.example.com
# mkdir ~/rss.example.com
# acme.sh --install-cert -d rss.example.com \
  --fullchain-file ~/rss.example.com/fullchain.pem \
  --key-file ~/rss.example.com/key.pem
  --reloadcmd &quot;service nginx force-reload&quot;

# acme.sh --issue --nginx -d rsshub.example.com
# mkdir ~/rsshub.example.com
# acme.sh --install-cert -d rsshub.example.com \
  --fullchain-file ~/rsshub.example.com/fullchain.pem \
  --key-file ~/rsshub.example.com/key.pem
  --reloadcmd &quot;service nginx force-reload&quot;
</code></pre>
<p>配置 Nginx HTTPS，编辑 <code>/etc/nginx/site-available/rss.conf</code> :</p>
<pre><code># Miniflux
server {
    listen 80;
    server_name rss.example.com;

    listen 443 ssl;

    ssl_certificate /root/rss.http-404.com/fullchain.pem;
    ssl_certificate_key /root/rss.http-404.com/key.pem;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers HIGH:!aNULL:!MD5;

    if ($scheme != &quot;https&quot;) {
      return 301 https://$host$request_uri;
    }

    index index.html;
    location / {
        proxy_pass http://127.0.0.1:8080;
    }
}

# RSSHub
server {
    listen 80;
    server_name rsshub.example.com;

    listen 443 ssl;

    ssl_certificate /root/rsshub.http-404.com/fullchain.pem;
    ssl_certificate_key /root/rsshub.http-404.com/key.pem;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers HIGH:!aNULL:!MD5;

    if ($scheme != &quot;https&quot;) {
        return 301 https://$host$request_uri;
    }

    index index.html;
    location / {
        proxy_pass http://127.0.0.1:1200;
    }
}
</code></pre>
<p>现在可以用 HTTPS 访问了。</p>
<p>PS: 配置过程中的一个小插曲，<code>ssl_certificate</code> 要用 <code>fullchain.pem</code> ，不要用 <code>cert.pem</code> ，否则访问可能出现下面的错误:</p>
<pre><code>x509: certificate signed by unknown authority
</code></pre>
<h2 id="配置-rsshub-用户认证">配置 RSSHub 用户认证</h2>
<p>现在这个建好的 RSSHub 服务是公开的，可以被别人直接访问使用。</p>
<p>我希望只给自己使用，不被白嫖，所以给它加上用户认证。</p>
<p>RSSHub 自带 HTTP 基础认证功能，但只给少部分路由开启，不符合我的需求。</p>
<p>这里我通过配置 Nginx 给所有路由加上 HTTP 基础认证。</p>
<p>使用 <code>htpasswd</code> 工具创建用户认证密码文件:</p>
<p>安装工具:</p>
<pre><code>$ sudo apt install apache2-utils
</code></pre>
<p>创建用户:</p>
<pre><code>$ sudo htpasswd -c /etc/nginx/htpasswd user1
</code></pre>
<p><code>user1</code> 是你想要的用户名，随便取，根据提示设定密码。</p>
<p><code>-c</code> 参数表示新建密码文件，如果文件已存在，去掉这个参数。</p>
<p>编辑 <code>/etc/nginx/site-available/rss.conf</code> ，找到 RSSHub 的 <code>location {}</code> 部分，修改为:</p>
<pre><code>location / {
    proxy_pass http://127.0.0.1:1200;
    auth_basic &quot;Restricted Content&quot;;
    auth_basic_user_file /etc/nginx/htpasswd;
}
</code></pre>
<p>重启 Nginx:</p>
<pre><code>sudo nginx -s reload
</code></pre>
<p>RSSHub 用户认证配置好了。在 Miniflux 中新增订阅时，在 <code>高级选项</code> 中填写刚才的用户名密码就可以了。</p>
<h2 id="移动端">移动端</h2>
<p>Miniflux 是一个 PWA(Progressive web app) 应用，跨平台，响应式设计，在手机浏览器中也有很好的体验。</p>
<p>在iOS 的 Safari 和 Android 的 Chrome 上你可以手机主界面上创建快捷方式，方便直接访问。</p>
<p>也可以使用第三方客户端连接，前提是在 Miniflux 设置里开启 Fever API:</p>
<p>Android 推荐 FeedMe:</p>
<ul>
<li><a href="https://play.google.com/store/apps/details?id=com.seazon.feedme">Google Play</a></li>
</ul>
<p>iOS 推荐 Reeder:</p>
<ul>
<li>在 Apple Store 中自行搜索</li>
</ul>
<h2 id="参考资料">参考资料</h2>
<p><a href="https://miniflux.app/docs/installation.html#docker">Miniflux Manual</a></p>
<p><a href="https://docs.rsshub.app/install/#docker-compose-bu-shu">RSSHub 官方文档</a></p>
<p><a href="https://github.com/acmesh-official/acme.sh">Acme.sh Documentation</a></p>
<p><a href="http://nginx.org/en/docs/http/configuring_https_servers.html">Nginx Configuring HTTPS</a></p>
<p><a href="https://www.nginx.com/blog/using-free-ssltls-certificates-from-lets-encrypt-with-nginx/">Using Let&rsquo;s Encrypt with Nginx</a></p>
<p><a href="https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/">Nginx configuring HTTP Basic Authentication</a></p>
<p><a href="https://github.com/matrix-org/matrix-federation-tester/issues/59">x509: certificate signed by unknown authority</a></p>

        </div>
        <div class="article-info">
    
        <div class="article-date">2020-03-19</div>
    
    <div class="article-taxonomies">
        
            
    </div>
</div>
    </article>
    


        </main>
        <footer>
            
                <p>© 2020<br>
Powered by <a target="_blank" href="https://gohugo.io/">Hugo</a>, theme <a target="_blank" href="https://github.com/mitrichius/hugo-theme-anubis">Anubis</a>.
</p>
            
        </footer>
    </div>
</body>
</html>
